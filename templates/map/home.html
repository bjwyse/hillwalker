<html>
<head>
<title>HillWalker</title>

<script src="http://www.mapquestapi.com/sdk/js/v7.0.s/mqa.toolkit.js?key=Fmjtd%7Cluu7n1u2nq%2C2l%3Do5-5rbad"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript">

      /*An example of using the MQA.EventUtil to hook into the window load event and execute defined function
      passed in as the last parameter. You could alternatively create a plain function here and have it
      executed whenever you like (e.g. <body onload="yourfunction">).*/

    $(document).ready(function(){
      MQA.EventUtil.observe(window, 'load', function() {

        /*Create an object for options*/
        var options={
          elt:document.getElementById('map'),        /*ID of element on the page where you want the map added*/
          zoom:13,                                   /*initial zoom level of map*/
          latLng:{lat:53.010278, lng:-6.3275},   /*center of map in latitude/longitude*/
          mtype:'map',                               /*map type (map)*/
          bestFitMargin:0,                           /*margin offset from the map viewport when applying a bestfit on shapes*/
          zoomOnDoubleClick:true                     /*zoom in when double-clicking on map*/
        };

        /*Construct an instance of MQA.TileMap with the options object*/
        window.map = new MQA.TileMap(options);
        
		        
		MQA.EventManager.addListener(window.map, 'moveend', eventMoveEnd);
 		eventMoveEnd(null);
 		
 		var imageOverlay;
	
  		function eventMoveEnd(evt){
			var currentUpperLeftLat = window.map.getBounds().ul.getLatitude();
			var currentUpperLeftLng = window.map.getBounds().ul.getLongitude();
			$('#output-ul').html('top-left: (' + currentUpperLeftLat + ',' + currentUpperLeftLng + ')</br>');
			var currentLowerRightLat = window.map.getBounds().lr.getLatitude();
			var currentLowerRightLng = window.map.getBounds().lr.getLongitude();
			$('#output-lr').html('top-left: (' + currentLowerRightLat + ',' + currentLowerRightLng + ')</br>');
			$("#image-link").attr("href", "/contour_image/?ul=" + currentUpperLeftLat + ',' + currentUpperLeftLng + '&lr=' + currentLowerRightLat + ',' + currentLowerRightLng)
			
    /*Set the URL of the image*/
    		MQA.withModule('shapes', function() {
    			if (imageOverlay) {
    				map.removeShape(imageOverlay);
    			}
   				imageOverlay = new MQA.ImageOverlay(); 
    			imageOverlay.imageURL="/contour_image/?ul=" + currentUpperLeftLat + ',' + currentUpperLeftLng + '&lr=' + currentLowerRightLat + ',' + currentLowerRightLng;

			    /*Sets the shape points. They must be in the following order [upper left latitude, upper left longitude, 
    			lower right latitude, lower right longitude] to define the upper left and lower right corners of the rectangle.*/ 
	    		imageOverlay.shapePoints=[currentUpperLeftLat, currentUpperLeftLng, currentLowerRightLat, currentLowerRightLng];
	    		map.addShape(imageOverlay);
	    	});

    /*Add to the map's default shape collection*/ 
  		}

		
      });
    });


    </script>
  </head>

  <body>
    <div id='map' style='width:400px; height:400px;'></div>
    <div id='output-ul' style='font-family:"courier"' >Output:<br/></div>
    <div id='output-lr' style='font-family:"courier"' >Output:<br/></div>
    <a id="image-link" href="">Image</a>
  </body>
</html>

